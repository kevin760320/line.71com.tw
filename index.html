function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);

    const brevoApiKey = '你的 Brevo API 金鑰'; // ← 替換為你自己的金鑰

    // 驗證 base64
    if (!data.image_data || data.image_data.startsWith("data:image")) {
      throw new Error("圖片格式錯誤，請確認 base64 沒有包含前綴");
    }

    const payload = {
      sender: {
        name: data.from_name || "網站表單",
        email: data.from_email || "你 Brevo 驗證過的 email"
      },
      to: [{
        name: data.to_name || "",
        email: data.to_email
      }],
      subject: "簽名表單資料",
      htmlContent: `<p>以下為簽名表單截圖：</p><img src="cid:formImage" />`,
      attachment: [{
        content: data.image_data,
        name: "form.png",
        type: "image/png",
        contentId: "formImage"
      }]
    };

    const options = {
      method: "post",
      contentType: "application/json",
      headers: {
        "api-key": brevoApiKey,
        "accept": "application/json"
      },
      payload: JSON.stringify(payload)
    };

    const response = UrlFetchApp.fetch("https://api.brevo.com/v3/smtp/email", options);
    const responseText = response.getContentText();
    Logger.log("Brevo 回應：" + responseText);

    return ContentService
      .createTextOutput(JSON.stringify({ status: "success", response: responseText }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    Logger.log("錯誤：" + err.message);
    return ContentService
      .createTextOutput(JSON.stringify({ status: "error", message: err.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
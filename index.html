<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>委刊表填寫與簽名</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #formArea { border: 1px solid #ccc; padding: 20px; display: inline-block; }
    #signaturePreview { width: 100%; max-width: 600px; border: 1px solid #000; }
    #loading { color: red; margin-top: 10px; display: none; }
  </style>
</head>
<body>
  <h2>簽名與表單寄送</h2>

  <div id="formArea">
    <img id="signaturePreview" src="" alt="簽名預覽">
  </div>

  <form id="sendForm" method="POST" action="https://script.google.com/macros/s/AKfycbxf5DiQUJ5EbZ7dsxK_SduJMHBql5yw9R5iK0FaHrhO_VrF_PMxzBk9KN_MmA8b7_67/exec">
    <input type="hidden" name="from_name" value="Kevin 測試系統">
    <input type="hidden" name="to_email" value="kevin.hsia@icloud.com">
    <input type="hidden" name="to_name" value="Kevin">
    <input type="hidden" name="image_data" id="image_data">
    <button type="button" onclick="captureAndSend()">產生簽名圖並送出</button>
  </form>

  <div id="loading">寄送中，請稍候...</div>

  <script>
    // 載入簽名圖片
    window.addEventListener("focus", () => {
      const dataUrl = localStorage.getItem("signatureData");
      if (dataUrl) document.getElementById("signaturePreview").src = dataUrl;
    });

    function captureAndSend() {
      const loading = document.getElementById("loading");
      loading.style.display = "block";

      html2canvas(document.getElementById("formArea")).then(canvas => {
        const base64 = canvas.toDataURL("image/png").split(",")[1];
        document.getElementById("image_data").value = base64;
        document.getElementById("sendForm").submit();
        setTimeout(() => loading.style.display = "none", 2000);
      });
    }
  </script>
</body>
</html>
